{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Appointment Booking Schema",
  "description": "JSON schema for the appointment booking request and response",
  "definitions": {
    "AppointmentRequest": {
      "type": "object",
      "description": "Request payload for booking an appointment",
      "properties": {
        "first_name": {
          "type": "string",
          "description": "Caller's first name",
          "example": "Alice"
        },
        "last_name": {
          "type": "string",
          "description": "Caller's last name",
          "example": "Smith"
        },
        "dob": {
          "type": "string",
          "description": "Caller's date of birth in ISO 8601 format (YYYY-MM-DD)",
          "format": "date",
          "example": "1990-05-20"
        },
        "insurance_provider": {
          "type": "string",
          "description": "Name of the insurance provider",
          "example": "HealthOne"
        },
        "reason": {
          "type": "string",
          "description": "Reason for the visit/appointment",
          "example": "Consultation"
        },
        "requested_datetime": {
          "type": "string",
          "description": "Requested appointment date and time in ISO 8601 format (YYYY-MM-DDTHH:MM:SS)",
          "format": "date-time",
          "example": "2025-12-10T15:30:00"
        }
      },
      "additionalProperties": false
    },
    "IncompleteResponse": {
      "type": "object",
      "description": "Response when required fields are missing",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["incomplete"],
          "example": "incomplete"
        },
        "missing_fields": {
          "type": "array",
          "description": "List of required fields that are missing",
          "items": {
            "type": "string"
          },
          "example": ["dob", "insurance_provider", "reason", "requested_datetime"]
        },
        "message": {
          "type": "string",
          "description": "Instructions for the caller",
          "example": "Please provide the missing fields."
        }
      },
      "required": ["status", "missing_fields", "message"]
    },
    "SuccessfulBookingResponse": {
      "type": "object",
      "description": "Response when appointment is successfully booked",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["booked"],
          "example": "booked"
        },
        "appointment": {
          "type": "object",
          "description": "The booked appointment details",
          "properties": {
            "id": {
              "type": "string",
              "description": "Unique appointment ID (UUID)",
              "example": "587b3127-bc21-40c4-9efe-7969ec46aeef"
            },
            "first_name": {
              "type": "string",
              "example": "Alice"
            },
            "last_name": {
              "type": "string",
              "example": "Smith"
            },
            "dob": {
              "type": "string",
              "format": "date",
              "example": "1990-05-20"
            },
            "insurance_provider": {
              "type": "string",
              "example": "HealthOne"
            },
            "reason": {
              "type": "string",
              "example": "Consultation"
            },
            "requested_datetime": {
              "type": "string",
              "format": "date-time",
              "example": "2025-12-10T15:30:00"
            },
            "created_at": {
              "type": "string",
              "format": "date-time",
              "description": "UTC timestamp when the appointment was created",
              "example": "2025-12-02T20:00:19.117296Z"
            }
          },
          "required": ["id", "first_name", "last_name", "dob", "insurance_provider", "reason", "requested_datetime", "created_at"]
        }
      },
      "required": ["status", "appointment"]
    },
    "UnavailableResponse": {
      "type": "object",
      "description": "Response when requested time slot is not available",
      "properties": {
        "status": {
          "type": "string",
          "enum": ["unavailable"],
          "example": "unavailable"
        },
        "message": {
          "type": "string",
          "description": "Reason and next steps",
          "example": "Requested time is already booked. Please provide a new booking time."
        }
      },
      "required": ["status", "message"]
    },
    "AvailabilityResponse": {
      "type": "object",
      "description": "Response from checking availability of a time slot",
      "properties": {
        "available": {
          "type": "boolean",
          "description": "Whether the requested time slot is available",
          "example": true
        },
        "reason": {
          "type": "string",
          "description": "Reason if slot is not available",
          "example": "Slot already booked"
        }
      },
      "required": ["available"]
    }
  },
  "endpoints": {
    "POST /book-appointment": {
      "description": "Book an appointment with caller information. Validates all required fields and checks availability.",
      "request": {
        "$ref": "#/definitions/AppointmentRequest"
      },
      "responses": {
        "200_incomplete": {
          "description": "Required fields are missing",
          "$ref": "#/definitions/IncompleteResponse"
        },
        "200_booked": {
          "description": "Appointment successfully booked",
          "$ref": "#/definitions/SuccessfulBookingResponse"
        },
        "200_unavailable": {
          "description": "Requested time slot is not available",
          "$ref": "#/definitions/UnavailableResponse"
        }
      }
    },
    "GET /availability": {
      "description": "Check if a specific date-time slot is available",
      "parameters": {
        "requested_datetime": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 datetime to check availability",
          "example": "2025-12-10T15:30:00"
        }
      },
      "responses": {
        "200": {
          "$ref": "#/definitions/AvailabilityResponse"
        }
      }
    }
  },
  "examples": [
    {
      "first_name": "Alice",
      "last_name": "Smith",
      "dob": "1990-05-20",
      "insurance_provider": "HealthOne",
      "reason": "Annual Checkup",
      "requested_datetime": "2025-12-10T15:30:00"
    },
    {
      "status": "incomplete",
      "missing_fields": ["dob", "insurance_provider", "reason", "requested_datetime"],
      "message": "Please provide the missing fields."
    },
    {
      "status": "booked",
      "appointment": {
        "id": "587b3127-bc21-40c4-9efe-7969ec46aeef",
        "first_name": "Alice",
        "last_name": "Smith",
        "dob": "1990-05-20",
        "insurance_provider": "HealthOne",
        "reason": "Annual Checkup",
        "requested_datetime": "2025-12-10T15:30:00",
        "created_at": "2025-12-02T20:00:19.117296Z"
      }
    },
    {
      "status": "unavailable",
      "message": "Requested time is already booked. Please provide a new booking time."
    },
    {
      "available": true
    },
    {
      "available": false,
      "reason": "Slot already booked"
    }
  ]
}
